{% extends "layout.html" %}

{% block content %}
<style>
    /* ·∫®n thanh cu·ªôn nh∆∞ng v·∫´n cho ph√©p cu·ªôn (t√πy ch·ªçn th·∫©m m·ªπ) */
    .hourly-scroll::-webkit-scrollbar {
        height: 8px;
    }
    .hourly-scroll::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 10px;
    }
    .hourly-scroll::-webkit-scrollbar-thumb {
        background: #c1c1c1;
        border-radius: 10px;
    }
    .hourly-scroll::-webkit-scrollbar-thumb:hover {
        background: #a8a8a8;
    }
    /* Th√™m class n√†y ƒë·ªÉ x·ª≠ l√Ω m√†u ƒë·ªông */
    .aqi-badge {
        background-color: var(--aqi-bg);
        color: var(--aqi-text);
    }
</style>

<div class="container mt-4" style="max-width: 900px;">
    
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2><span class="text-muted">Weather for:</span> {{ room.name }}</h2>
        <div>
            <a href="{{ url_for('chat.chat_room', room_name=room.name) }}" class="btn btn-outline-secondary btn-sm">Chat</a>
            <a href="{{ url_for('planner.view_planner', room_id=room.id) }}" class="btn btn-outline-secondary btn-sm">Planner</a>
            <a href="{{ url_for('finance.view_finance', room_id=room.id) }}" class="btn btn-outline-secondary btn-sm">Finance</a>
        </div>
    </div>

    <div class="mb-4">
        <form action="{{ request.path }}" method="get" class="d-flex gap-2">
            <input type="text" name="city" class="form-control" placeholder="Nh·∫≠p t√™n th√†nh ph·ªë (VD: Hanoi, London...)" value="{{ request.args.get('city', '') }}">
            <button type="submit" class="btn btn-primary">T√¨m</button>
            {% if request.args.get('city') %}
                <a href="{{ request.path }}" class="btn btn-outline-secondary">Reset HCM</a>
            {% endif %}
        </form>
    </div>

    {% if weather and weather.current_weather %}
        {% set cur = weather.current_weather %}
        
        <div class="card text-white mb-4 shadow" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; border-radius: 20px;">
            <div class="card-body p-5">
                <div class="row align-items-center">
                    <div class="col-md-6">
                        <h4 class="fw-light opacity-75">
                            <i class="fas fa-map-marker-alt me-2"></i>{{ location_name }}
                        </h4>
                        <h1 style="font-size: 5rem; font-weight: bold;">{{ cur.temperature }}¬∞C</h1>
                        <p class="fs-5 mb-0">{{ cur.weather_desc }}</p>
                        <div class="mt-4 d-flex flex-wrap gap-2">
                            <span class="badge bg-white text-dark shadow-sm d-flex align-items-center" style="font-size: 1.1rem; padding: 12px 18px; border-radius: 15px;">
                                <span class="me-2 fs-5">üíß</span> {{ cur.precipitation_sum }} mm
                            </span>
                            <span class="badge bg-white text-dark shadow-sm d-flex align-items-center" style="font-size: 1.1rem; padding: 12px 18px; border-radius: 15px;">
                                <span class="me-2 fs-5">üí®</span> {{ cur.wind_max_kmh }} km/h
                            </span>
                            <span class="badge shadow-sm d-flex align-items-center" 
                                  style="--aqi-bg: {{ cur.aqi_bg }}; --aqi-text: {{ cur.aqi_text }}; background-color: var(--aqi-bg); color: var(--aqi-text); font-size: 1.1rem; padding: 12px 18px; border-radius: 15px;">
                                <span class="me-2 fs-5">üçÉ</span> AQI {{ cur.aqi_val }}
                            </span>
                        </div>
                    </div>
                    
                    <div class="col-md-6 text-center text-md-end">
                        <div style="font-size: 8rem; line-height: 1;">
                            {% if 'M∆∞a' in cur.weather_desc %} üåßÔ∏è
                            {% elif 'N·∫Øng' in cur.weather_desc or 'Quang' in cur.weather_desc %} ‚òÄÔ∏è
                            {% elif 'M√¢y' in cur.weather_desc %} ‚õÖ
                            {% else %} üå§Ô∏è
                            {% endif %}
                        </div>
                        
                        <div class="mt-3 text-end">
                            {% for risk in cur.daily_risks %}
                                {% if risk == 'RISK_HEAVY_RAIN' %}
                                    <div class="alert alert-danger d-inline-block py-1 px-3 m-0 border-0 shadow-sm">‚òî C·∫£nh b√°o m∆∞a l·ªõn!</div>
                                {% elif risk == 'RISK_EXTREME_HEAT' %}
                                    <div class="alert alert-danger d-inline-block py-1 px-3 m-0 border-0 shadow-sm">‚òÄÔ∏è N·∫Øng n√≥ng gay g·∫Øt!</div>
                                {% elif risk == 'WARNING_LIGHT_RAIN' %}
                                    <div class="alert alert-warning d-inline-block py-1 px-3 m-0 border-0 shadow-sm text-dark">üåßÔ∏è C√≥ m∆∞a nh·∫π</div>
                                {% elif risk == 'NORMAL' %}
                                    <div class="alert alert-success d-inline-block py-1 px-3 m-0 border-0 shadow-sm">‚úÖ Th·ªùi ti·∫øt ƒë·∫πp</div>
                                {% endif %}
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <h5 class="mb-3 text-muted">D·ª± b√°o 24 gi·ªù t·ªõi</h5>
        
        <div class="d-flex flex-nowrap overflow-auto py-2 hourly-scroll" style="scroll-behavior: smooth;">
            {% for hour in weather.hourly_forecast %}
            <div class="col-3 col-md-2 px-2 mb-2" style="min-width: 130px;">
                <div class="card h-100 border-0 shadow text-center py-4" style="background-color: #ffffff; border-radius: 16px;">
                    <div class="text-secondary fw-bold mb-1">{{ hour.hour }}</div>
                    
                    <div class="my-2" style="font-size: 3rem;">
                        {% if 'M∆∞a' in hour.weather_desc %} üåßÔ∏è
                        {% elif 'N·∫Øng' in hour.weather_desc or 'Quang' in hour.weather_desc %} ‚òÄÔ∏è
                        {% elif 'M√¢y' in hour.weather_desc %} ‚òÅÔ∏è
                        {% else %} ‚õÖ
                        {% endif %}
                    </div>

                    <div class="fw-bolder text-dark" style="font-size: 1.5rem;">{{ hour.temp }}¬∞C</div>
                    
                    <div class="text-muted text-truncate px-2 mt-1" style="font-size: 0.85rem; font-weight: 500;">
                        {{ hour.weather_desc }}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>

    {% else %}
        <div class="alert alert-warning">Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu th·ªùi ti·∫øt cho ƒë·ªãa ƒëi·ªÉm n√†y. Vui l√≤ng th·ª≠ l·∫°i t√™n kh√°c.</div>
    {% endif %}
</div>
{% endblock %}